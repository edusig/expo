# Expo Stories


## Getting Started

Navigate to `packages/<packageName`> and run `et run-stories`

If it is the first time anyone has done this (e.g there are no stories yet), `run-stories` will create all the necessary configuration and files required. 

What you'll need to do next is figure out which native packages (e.g if we need to install any Cocoapods) are required by the package's story components - a good reference to use is in `apps/native-component-list/src/screens`. If there are any extras require, add them to the packages `expoStories.packages` field in `package.json.


There are 3 primary components in this system:

- the expo tool `et run-stories` which generates and starts a project for a given package
- the app which is a react native client for rendering a given packages' story files
- the server which watches and generates files that are read by the app


## Expo Tool: `et run-stories [package]`

This is used to scaffold a new project in the `story-loaders` directory by running a few `expo-cli` commands and copying over some template files in order to get things working

## Expo Story App

This is a generic React Native app that renders components declared in a given packages story files. It does so by reading the `stories.js` file in the `__generated__` directory of the project. 

This file is generated by running a story server at the root of the project, which acts as a file watcher for story files (starting the server is already taken care of by `et run-stories`.) 

One really important feature that must work is fast refresh - the story server generates a file that is Metro friendly, but its something that can be quite finicky so its important to keep in mind and continuously test

## Expo Story Server

This is a node server that watches for files with the `.stories` extension in a given project. When it finds a file, it then parses and updates the `stories.js` file in a configured project root so that the React app is aware of it.

## Contributing

1. In order to move NCL components to a package, you'll need to determine which native dependencies are required by the package (and its example components) and then add these to the `package.json`

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f2853130-d2e7-4a28-ba13-808cc6b39ae7/Screen_Shot_2021-07-29_at_1.34.28_PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f2853130-d2e7-4a28-ba13-808cc6b39ae7/Screen_Shot_2021-07-29_at_1.34.28_PM.png)

This is the configuration for `expo-av` 

1. To make it easier for others to get up and running, add the `expotool` to npm scripts: 

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5198815c-45e5-4255-8a90-ec4e83eac6a8/Screen_Shot_2021-07-29_at_1.34.34_PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5198815c-45e5-4255-8a90-ec4e83eac6a8/Screen_Shot_2021-07-29_at_1.34.34_PM.png)

1. Update `tsconfig.json` to ignore story files from being transpiled: 

    ![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/00f3ee7d-e4d9-42f8-84d0-5fb2fc1e8c17/Screen_Shot_2021-07-29_at_1.41.02_PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/00f3ee7d-e4d9-42f8-84d0-5fb2fc1e8c17/Screen_Shot_2021-07-29_at_1.41.02_PM.png)

**Note:** We could create a simple command (e.g `et init-stories`) to do some of this for us, although there is some manual work involved when hunting for native dependencies

1. Create a `__stories__` directory in the `src` of the package, and copy over any NCL components to that file. Sometimes these components reference values that are shared between NCL components - in this case, you can find constants and the like in the `expo-stories/shared/{constants,components,etc}` directory - if there is something used in NCL that is not in the shared directory then add it so others can use it in the future. 

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/adb0a3a5-df99-4942-a1ff-b3ce2ac315a1/Screen_Shot_2021-07-29_at_1.44.24_PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/adb0a3a5-df99-4942-a1ff-b3ce2ac315a1/Screen_Shot_2021-07-29_at_1.44.24_PM.png)

`.stories.tsx` files export the components that are available in the react native app

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f3c9d8a6-ba48-4f04-81a6-a2e449cc2ab4/Screen_Shot_2021-07-29_at_1.45.16_PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f3c9d8a6-ba48-4f04-81a6-a2e449cc2ab4/Screen_Shot_2021-07-29_at_1.45.16_PM.png)

VideoHttpPlayer will now be a story in the `expo-av` stories app

## Future Plans and Ideas

### Android Autolinking in monorepo

There seems to be some changes going on around mono repos and auto linking - holding off on Android implementations until this is working. In the mean time, any story can be run from the `Exponent` native client for Android

### Adding test suite

Test suite is another set of components that would ideally live in the package directory instead of the `apps` directory - the process should be similar to what has been laid out for stories, but I haven't given this too much though yet. This would be a pretty important thing to get working, especially for external contributions so that they can quickly see if updates are breaking our tests

The overall idea behind stories is that they export React components that can be used in your tests, so your stories serve as the basis for both visual and automated tests - we could update our tests so that they follow this model a little closer

### Interacting with stories via web app

If we improve the interaction between the native app and the story server via web sockets, we can then build a web app that can communicate and control the native app as well. 

This would let us build richer tools to improve the QA and development experience - these are just some ideas that come to mind:

- quickly filter through components and select stories via keyboard instead of on a device
- include more information about different stories (e.g descriptions, what to look for when using the components, any additional notes) and thereby improve our documentation
- standardize a QA process with a checklist
- integrate with linear to quickly create issues without disrupting your workflow

### Extract automated example sections in our docs

Especially relevant for web stories where we could render them directly - we could automate / generate example sections in our docs that both document how to use our APIs and give a quick visual indication of what the component looks like / does